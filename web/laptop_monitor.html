<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />

    <script type="text/javascript" src="js/eventemitter2.min.js"></script>
    <script type="text/javascript" src="js/roslib.min.js"></script>

    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <script type="text/javascript" src="js/monitor.js"></script>

    <script type="text/javascript" type="text/javascript">
        // Connecting to ROS
        // -----------------

        // Publishing a Topic
        // ------------------

        var cmdVel = new ROSLIB.Topic({
            ros: ros,
            name: '/cmd_vel',
            messageType: 'geometry_msgs/Twist'
        });

        var twist = new ROSLIB.Message({
            linear: {
                x: 0.1,
                y: 0.2,
                z: 0.3
            },
            angular: {
                x: -0.1,
                y: -0.2,
                z: -0.3
            }
        });
        cmdVel.publish(twist);

        // Subscribing to a Topic
        // ----------------------

        // var image_topic = new ROSLIB.Topic({
        //     ros: ros,
        //     name: '/camera/fisheye1/image_raw/compressed',
        //     messageType: 'sensor_msgs/CompressedImage'
        // });

        // var image_undistorted_topic = new ROSLIB.Topic({
        //     ros: ros,
        //     name: '/camera/fisheye1/rect/image/compressed',
        //     messageType: 'sensor_msgs/CompressedImage'
        // });

        // var mavros_vision_pose = new ROSLIB.Topic({
        //     ros: drone-ros,
        //     name: '/mavros/vision_pose/pose',
        //     messageType: 'geometry_msgs/PoseStamped'
        // });        

        // image_topic.subscribe(function (message) {
        //     document.getElementById('my_image').src = "data:image/jpg;base64," + message.data;
        // });

        // image_undistorted_topic.subscribe(function (message) {
        //     document.getElementById('my_image_undistorted').src = "data:image/jpg;base64," + message.data;
        //     cmdVel.publish(twist);
        // });

        mavros_vision_pose.subscribe(function (message) {
            let q = message.pose.orientation;
            var yaw = Math.atan2(2.0 * (q.y * q.z + q.w * q.x), q.w * q.w - q.x * q.x - q.y * q.y + q.z * q.z);
            var pitch = Math.asin(-2.0 * (q.x * q.z - q.w * q.y));
            var roll = Math.atan2(2.0 * (q.x * q.y + q.w * q.z), q.w * q.w + q.x * q.x - q.y * q.y - q.z * q.z);
            $("#drone-position-x").val(Math.round(message.pose.position.x * rounding_factor) / rounding_factor);
            $("#drone-position-y").val(Math.round(message.pose.position.y * rounding_factor) / rounding_factor);
            $("#drone-position-z").val(Math.round(message.pose.position.z * rounding_factor) / rounding_factor);
            $("#drone-orientation-yaw").val(Math.round(yaw * 180 / Math.PI * rounding_factor) / rounding_factor);
            $("#drone-orientation-pitch").val(Math.round(pitch * 180 / Math.PI * rounding_factor) / rounding_factor);
            $("#drone-orientation-roll").val(Math.round(roll * 180 / Math.PI * rounding_factor) / rounding_factor);
        });        


        // Getting and setting a param value
        // ---------------------------------

        ros.getParams(function (params) {
            console.log(params);
        });

        var maxVelX = new ROSLIB.Param({
            ros: ros,
            name: 'max_vel_y'
        });

        maxVelX.set(0.8);
        maxVelX.get(function (value) {
            console.log('MAX VAL: ' + value);
        });
    </script>
</head>

<body style="padding:10px">
    <h1>Drone Monitoring</h1>
    <p>GUI monitoring of Drone and UGV.</p>
    
    <div class="row">
        <div class="col-10 col-md-4 my-1">
            <div class="input-group" id="form-IP">
                <div class="input-group-prepend">
                    <div class="input-group-text">IP Address</div>
                </div>
                <input type="text" class="form-control form-border-error" id="drone-IP">
            </div>
        </div>
        <div class="col-2 my-1"><button type="button" class="btn btn-primary" id="submit-IP">Submit</button></div>
    </div>

    <div class="row">
        <div class="col-12 col-md-6">
            <div class="title">Status</div>
            <div class="box">
                <div class="subtitle">Drone Monitor</div>
                <form>
                    <div class="row">
                        <div class="col-12 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Time</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-heartbeat">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-4 col-md-4 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">x</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-position-x">
                            </div>
                        </div>
                        <div class="col-4 col-md-4 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">y</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-position-y">
                            </div>
                        </div>
                        <div class="col-4 col-md-4 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">z</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-position-z">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-4 col-md-4 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Yaw</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-orientation-yaw">
                            </div>
                        </div>
                        <div class="col-4 col-md-4 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Pitch</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-orientation-pitch">
                            </div>
                        </div>
                        <div class="col-4 col-md-4 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Roll</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-orientation-roll">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="box">
                <div class="subtitle">UGV Monitor</div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="title">Flying Status</div>
            <div class="box">
                <form>
                    <div class="row">
                        <div class="col-12 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Flight Mode</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-flight-mode">
                            </div>
                        </div>
                        <div class="col-12 col-md-9 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Waypoint #1</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-waypoint1">
                            </div>
                        </div>
                        <div class="col-12 col-md-9 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Waypoint #2</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-waypoint2">
                            </div>
                        </div>
                        <div class="col-12 col-md-9 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Waypoint #3</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-waypoint3">
                            </div>
                        </div>
                        <div class="col-12 col-md-9 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Waypoint #4</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-waypoint4">
                            </div>
                        </div>
                        <div class="col-12 col-md-9 my-1">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Waypoint #5</div>
                                </div>
                                <input type="text" class="form-control" readonly id="drone-waypoint5">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="title">Drone Controls</div>
            <div class="box">
                <div class="controls-div">
                    <button type="button" class="btn btn-warning" disabled id="command-takeoff">Take-Off Request /\</button>
                </div>
                <div class="controls-div">
                    <button type="button" class="btn btn-primary" disabled id="command-move">Relative Move</button>
                </div>
                <div class="controls-div">
                    <button type="button" class="btn btn-primary" disabled id="command-search">Search Command</button>
                </div>
                <div class="controls-div">
                    <button type="button" class="btn btn-primary" disabled id="command-follow">Follow</button>
                </div>
                <div class="controls-div">
                    <button type="button" class="btn btn-dark" disabled id="command-clear">Clear Commands</button>
                </div>
            </div>

            
        </div>
        
    </div>
    <div class="row">
        <div class="title">Camera Views</div>
            <div class="controls-div">
                <button class="btn btn-warning" type="button" data-bs-toggle="collapse" disabled data-bs-target="#collapse-camera" id="show-camera"
                    aria-expanded="false" aria-controls="collapseExample">
                    Show Camera Image
                </button>
                <button class="btn btn-secondary" type="button" disabled id="show-apriltags">
                    Show AprilTags
                </button>
                <button class="btn btn-warning" type="button" data-bs-toggle="collapse" disabled data-bs-target="#collapse-maps" id="show-maps"
                    aria-expanded="false" aria-controls="collapseExample">
                    Show Undistorted and Depth Map
                </button>
            </div>
    </div>
    <br>
    <div class="row"> 
        <div class="col-4">
            <div class="title text-center">T265 Camera</div>
            <div class="collapse" id="collapse-camera">
                <div class="card card-body">
                    <img id="drone-camera" style='height: 100%; width: 100%; object-fit: contain' src="assets/img/placeholder.png">
                </div>
                
            </div>    
        </div>
        <div class="col-4">
            <div class="title text-center">Undistorted View</div>
            <div class="collapse" id="collapse-maps">
                <div class="card card-body">
                    <img id="drone-undistorted" style='height: 100%; width: 100%; object-fit: contain' src="assets/img/placeholder.png">
                </div>
            </div>
        </div>
        <div class="col-4">
            <div class="title text-center">Depth View</div>
            <div class="collapse" id="collapse-maps">
                <div class="card card-body">
                    <img id="drone-depth" style='height: 100%; width: 100%; object-fit: contain' src="assets/img/placeholder.png">
                </div>
            </div>
        </div>
    </div>
    
</body>

</html>